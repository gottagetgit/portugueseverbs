<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portuguese Verb Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .progress {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
        }

        .quiz-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .prompt {
            font-size: 24px;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .english-phrase {
            font-size: 32px;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .input-group {
            margin: 20px 0;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input.correct {
            border-color: #28a745;
            background-color: #d4edda;
        }

        input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
        }

        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .correct-answer {
            font-weight: bold;
            font-size: 20px;
            margin-top: 10px;
        }

        #submitBtn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            margin-top: 20px;
        }

        #submitBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #submitBtn:active {
            transform: translateY(0);
        }

        #submitBtn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        button {
            font-family: inherit;
        }

        .completion {
            text-align: center;
            padding: 40px 20px;
        }

        .completion h2 {
            color: #28a745;
            font-size: 36px;
            margin-bottom: 20px;
        }

        .completion p {
            font-size: 18px;
            color: #666;
            margin: 10px 0;
        }

        .hint {
            text-align: center;
            color: #999;
            font-size: 14px;
            margin-top: 10px;
        }

        .verb-info {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            font-style: italic;
        }

        .tense-selector {
            margin: 20px 0;
            text-align: center;
        }

        .tense-selector label {
            color: #666;
            font-size: 16px;
            font-weight: 600;
            margin-right: 10px;
        }

        .tense-selector select {
            padding: 10px 20px;
            font-size: 16px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tense-selector select:hover {
            background: #f8f9fa;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .tense-selector select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .accent-buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .accent-btn {
            width: 40px;
            height: 40px;
            padding: 0;
            margin: 0;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            transition: all 0.2s;
        }

        .accent-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .accent-btn:active {
            transform: translateY(0);
        }

        .mistakes-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .mistakes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .mistakes-title {
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
        }

        .mistakes-count {
            background: #dc3545;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .mistakes-list {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .mistakes-list::-webkit-scrollbar {
            width: 8px;
        }

        .mistakes-list::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }

        .mistakes-list::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .mistakes-list::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .mistakes-list:empty::after {
            content: "No mistakes yet! Keep going! üí™";
            color: #999;
            font-style: italic;
            display: block;
            text-align: center;
            padding: 20px;
        }

        .mistake-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .mistake-english {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .mistake-answer {
            color: #28a745;
            font-size: 18px;
            font-weight: bold;
        }

        .mistake-verb-info {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üáµüáπ Portuguese Verb Quiz</h1>
        
        <div class="tense-selector">
            <label for="tenseSelect">Focus on:</label>
            <select id="tenseSelect" onchange="changeTense()">
                <option value="all">All Tenses (500 questions)</option>
                <option value="present">Present Tense (100 questions)</option>
                <option value="preterite">Preterite/Past Tense (100 questions)</option>
                <option value="imperfect">Imperfect Tense (100 questions)</option>
                <option value="future">Future Tense (100 questions)</option>
                <option value="conditional">Conditional Tense (100 questions)</option>
            </select>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progressBar">0/500</div>
        </div>

        <div class="stats" id="stats">
            Questions answered: 0 / 500
        </div>

        <div id="quizArea"></div>

        <div class="mistakes-section">
            <div class="mistakes-header">
                <div class="mistakes-title">üìù Review Your Mistakes</div>
                <div class="mistakes-count" id="mistakesCount">0</div>
            </div>
            <div class="mistakes-list" id="mistakesList"></div>
        </div>
    </div>

    <script>
        // Top 20 most common Portuguese verbs with conjugations
        const verbs = {
            ser: {
                infinitive: "ser",
                english: "to be",
                present: ["sou", "√©s", "√©", "somos", "s√£o"],
                preterite: ["fui", "foste", "foi", "fomos", "foram"],
                imperfect: ["era", "eras", "era", "√©ramos", "eram"],
                future: ["serei", "ser√°s", "ser√°", "seremos", "ser√£o"],
                conditional: ["seria", "serias", "seria", "ser√≠amos", "seriam"]
            },
            estar: {
                infinitive: "estar",
                english: "to be",
                present: ["estou", "est√°s", "est√°", "estamos", "est√£o"],
                preterite: ["estive", "estiveste", "esteve", "estivemos", "estiveram"],
                imperfect: ["estava", "estavas", "estava", "est√°vamos", "estavam"],
                future: ["estarei", "estar√°s", "estar√°", "estaremos", "estar√£o"],
                conditional: ["estaria", "estarias", "estaria", "estar√≠amos", "estariam"]
            },
            ter: {
                infinitive: "ter",
                english: "to have",
                present: ["tenho", "tens", "tem", "temos", "t√™m"],
                preterite: ["tive", "tiveste", "teve", "tivemos", "tiveram"],
                imperfect: ["tinha", "tinhas", "tinha", "t√≠nhamos", "tinham"],
                future: ["terei", "ter√°s", "ter√°", "teremos", "ter√£o"],
                conditional: ["teria", "terias", "teria", "ter√≠amos", "teriam"]
            },
            haver: {
                infinitive: "haver",
                english: "to have/exist",
                present: ["hei", "h√°s", "h√°", "havemos", "h√£o"],
                preterite: ["houve", "houveste", "houve", "houvemos", "houveram"],
                imperfect: ["havia", "havias", "havia", "hav√≠amos", "haviam"],
                future: ["haverei", "haver√°s", "haver√°", "haveremos", "haver√£o"],
                conditional: ["haveria", "haverias", "haveria", "haver√≠amos", "haveriam"]
            },
            fazer: {
                infinitive: "fazer",
                english: "to do/make",
                present: ["fa√ßo", "fazes", "faz", "fazemos", "fazem"],
                preterite: ["fiz", "fizeste", "fez", "fizemos", "fizeram"],
                imperfect: ["fazia", "fazias", "fazia", "faz√≠amos", "faziam"],
                future: ["farei", "far√°s", "far√°", "faremos", "far√£o"],
                conditional: ["faria", "farias", "faria", "far√≠amos", "fariam"]
            },
            ir: {
                infinitive: "ir",
                english: "to go",
                present: ["vou", "vais", "vai", "vamos", "v√£o"],
                preterite: ["fui", "foste", "foi", "fomos", "foram"],
                imperfect: ["ia", "ias", "ia", "√≠amos", "iam"],
                future: ["irei", "ir√°s", "ir√°", "iremos", "ir√£o"],
                conditional: ["iria", "irias", "iria", "ir√≠amos", "iriam"]
            },
            poder: {
                infinitive: "poder",
                english: "can/to be able",
                present: ["posso", "podes", "pode", "podemos", "podem"],
                preterite: ["pude", "pudeste", "p√¥de", "pudemos", "puderam"],
                imperfect: ["podia", "podias", "podia", "pod√≠amos", "podiam"],
                future: ["poderei", "poder√°s", "poder√°", "poderemos", "poder√£o"],
                conditional: ["poderia", "poderias", "poderia", "poder√≠amos", "poderiam"]
            },
            dizer: {
                infinitive: "dizer",
                english: "to say/tell",
                present: ["digo", "dizes", "diz", "dizemos", "dizem"],
                preterite: ["disse", "disseste", "disse", "dissemos", "disseram"],
                imperfect: ["dizia", "dizias", "dizia", "diz√≠amos", "diziam"],
                future: ["direi", "dir√°s", "dir√°", "diremos", "dir√£o"],
                conditional: ["diria", "dirias", "diria", "dir√≠amos", "diriam"]
            },
            dar: {
                infinitive: "dar",
                english: "to give",
                present: ["dou", "d√°s", "d√°", "damos", "d√£o"],
                preterite: ["dei", "deste", "deu", "demos", "deram"],
                imperfect: ["dava", "davas", "dava", "d√°vamos", "davam"],
                future: ["darei", "dar√°s", "dar√°", "daremos", "dar√£o"],
                conditional: ["daria", "darias", "daria", "dar√≠amos", "dariam"]
            },
            ver: {
                infinitive: "ver",
                english: "to see",
                present: ["vejo", "v√™s", "v√™", "vemos", "veem"],
                preterite: ["vi", "viste", "viu", "vimos", "viram"],
                imperfect: ["via", "vias", "via", "v√≠amos", "viam"],
                future: ["verei", "ver√°s", "ver√°", "veremos", "ver√£o"],
                conditional: ["veria", "verias", "veria", "ver√≠amos", "veriam"]
            },
            saber: {
                infinitive: "saber",
                english: "to know",
                present: ["sei", "sabes", "sabe", "sabemos", "sabem"],
                preterite: ["soube", "soubeste", "soube", "soubemos", "souberam"],
                imperfect: ["sabia", "sabias", "sabia", "sab√≠amos", "sabiam"],
                future: ["saberei", "saber√°s", "saber√°", "saberemos", "saber√£o"],
                conditional: ["saberia", "saberias", "saberia", "saber√≠amos", "saberiam"]
            },
            querer: {
                infinitive: "querer",
                english: "to want",
                present: ["quero", "queres", "quer", "queremos", "querem"],
                preterite: ["quis", "quiseste", "quis", "quisemos", "quiseram"],
                imperfect: ["queria", "querias", "queria", "quer√≠amos", "queriam"],
                future: ["quererei", "querer√°s", "querer√°", "quereremos", "querer√£o"],
                conditional: ["quereria", "quererias", "quereria", "querer√≠amos", "quereriam"]
            },
            vir: {
                infinitive: "vir",
                english: "to come",
                present: ["venho", "vens", "vem", "vimos", "v√™m"],
                preterite: ["vim", "vieste", "veio", "viemos", "vieram"],
                imperfect: ["vinha", "vinhas", "vinha", "v√≠nhamos", "vinham"],
                future: ["virei", "vir√°s", "vir√°", "viremos", "vir√£o"],
                conditional: ["viria", "virias", "viria", "vir√≠amos", "viriam"]
            },
            ficar: {
                infinitive: "ficar",
                english: "to stay/remain",
                present: ["fico", "ficas", "fica", "ficamos", "ficam"],
                preterite: ["fiquei", "ficaste", "ficou", "ficamos", "ficaram"],
                imperfect: ["ficava", "ficavas", "ficava", "fic√°vamos", "ficavam"],
                future: ["ficarei", "ficar√°s", "ficar√°", "ficaremos", "ficar√£o"],
                conditional: ["ficaria", "ficarias", "ficaria", "ficar√≠amos", "ficariam"]
            },
            p√¥r: {
                infinitive: "p√¥r",
                english: "to put",
                present: ["ponho", "p√µes", "p√µe", "pomos", "p√µem"],
                preterite: ["pus", "puseste", "p√¥s", "pusemos", "puseram"],
                imperfect: ["punha", "punhas", "punha", "p√∫nhamos", "punham"],
                future: ["porei", "por√°s", "por√°", "poremos", "por√£o"],
                conditional: ["poria", "porias", "poria", "por√≠amos", "poriam"]
            },
            trazer: {
                infinitive: "trazer",
                english: "to bring",
                present: ["trago", "trazes", "traz", "trazemos", "trazem"],
                preterite: ["trouxe", "trouxeste", "trouxe", "trouxemos", "trouxeram"],
                imperfect: ["trazia", "trazias", "trazia", "traz√≠amos", "traziam"],
                future: ["trarei", "trar√°s", "trar√°", "traremos", "trar√£o"],
                conditional: ["traria", "trarias", "traria", "trar√≠amos", "trariam"]
            },
            deixar: {
                infinitive: "deixar",
                english: "to leave/let",
                present: ["deixo", "deixas", "deixa", "deixamos", "deixam"],
                preterite: ["deixei", "deixaste", "deixou", "deixamos", "deixaram"],
                imperfect: ["deixava", "deixavas", "deixava", "deix√°vamos", "deixavam"],
                future: ["deixarei", "deixar√°s", "deixar√°", "deixaremos", "deixar√£o"],
                conditional: ["deixaria", "deixarias", "deixaria", "deixar√≠amos", "deixariam"]
            },
            falar: {
                infinitive: "falar",
                english: "to speak",
                present: ["falo", "falas", "fala", "falamos", "falam"],
                preterite: ["falei", "falaste", "falou", "falamos", "falaram"],
                imperfect: ["falava", "falavas", "falava", "fal√°vamos", "falavam"],
                future: ["falarei", "falar√°s", "falar√°", "falaremos", "falar√£o"],
                conditional: ["falaria", "falarias", "falaria", "falar√≠amos", "falariam"]
            },
            passar: {
                infinitive: "passar",
                english: "to pass",
                present: ["passo", "passas", "passa", "passamos", "passam"],
                preterite: ["passei", "passaste", "passou", "passamos", "passaram"],
                imperfect: ["passava", "passavas", "passava", "pass√°vamos", "passavam"],
                future: ["passarei", "passar√°s", "passar√°", "passaremos", "passar√£o"],
                conditional: ["passaria", "passarias", "passaria", "passar√≠amos", "passariam"]
            },
            chegar: {
                infinitive: "chegar",
                english: "to arrive",
                present: ["chego", "chegas", "chega", "chegamos", "chegam"],
                preterite: ["cheguei", "chegaste", "chegou", "chegamos", "chegaram"],
                imperfect: ["chegava", "chegavas", "chegava", "cheg√°vamos", "chegavam"],
                future: ["chegarei", "chegar√°s", "chegar√°", "chegaremos", "chegar√£o"],
                conditional: ["chegaria", "chegarias", "chegaria", "chegar√≠amos", "chegariam"]
            }
        };

        const pronouns = [
            { pt: "eu", en: "I" },
            { pt: "tu", en: "you (informal)" },
            { pt: "ele/ela/voc√™", en: "he/she/you" },
            { pt: "n√≥s", en: "we" },
            { pt: "eles/elas", en: "they" }
        ];

        const tenses = [
            { key: "present", name: "Present", index: 0 },
            { key: "preterite", name: "Preterite (Past)", index: 1 },
            { key: "imperfect", name: "Imperfect", index: 2 },
            { key: "future", name: "Future", index: 3 },
            { key: "conditional", name: "Conditional", index: 4 }
        ];

        // Generate all questions
        let questions = [];
        Object.keys(verbs).forEach(verbKey => {
            const verb = verbs[verbKey];
            tenses.forEach(tense => {
                pronouns.forEach((pronoun, pIndex) => {
                    const conjugation = verb[tense.key][pIndex];
                    const englishPhrase = generateEnglishPhrase(verb.english, tense.key, pronoun.en);
                    questions.push({
                        verb: verb.infinitive,
                        verbEnglish: verb.english,
                        tense: tense.name,
                        tenseKey: tense.key,
                        pronoun: pronoun.pt,
                        pronounEn: pronoun.en,
                        answer: `${pronoun.pt} ${conjugation}`,
                        englishPhrase: englishPhrase,
                        attempts: 0
                    });
                });
            });
        });

        // Shuffle questions
        questions = shuffleArray(questions);

        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let isWaitingForCorrection = false;
        let selectedTense = "all";
        let filteredQuestions = [];
        let mistakes = [];

        function generateEnglishPhrase(verbEn, tense, pronounEn) {
            const templates = {
                present: {
                    "I": "I ",
                    "you (informal)": "you ",
                    "he/she/you": "he/she ",
                    "we": "we ",
                    "they": "they "
                },
                preterite: {
                    "I": "I ",
                    "you (informal)": "you ",
                    "he/she/you": "he/she ",
                    "we": "we ",
                    "they": "they "
                },
                imperfect: {
                    "I": "I used to ",
                    "you (informal)": "you used to ",
                    "he/she/you": "he/she used to ",
                    "we": "we used to ",
                    "they": "they used to "
                },
                future: {
                    "I": "I will ",
                    "you (informal)": "you will ",
                    "he/she/you": "he/she will ",
                    "we": "we will ",
                    "they": "they will "
                },
                conditional: {
                    "I": "I would ",
                    "you (informal)": "you would ",
                    "he/she/you": "he/she would ",
                    "we": "we would ",
                    "they": "they would "
                }
            };

            let prefix = templates[tense][pronounEn];
            let verbText = verbEn;

            // Adjust for different tenses
            if (tense === "preterite") {
                // Convert to simple past
                if (verbEn === "to be") verbText = "was/were";
                else if (verbEn === "to have") verbText = "had";
                else if (verbEn === "to have/exist") verbText = "had/existed";
                else if (verbEn === "to do/make") verbText = "did/made";
                else if (verbEn === "to go") verbText = "went";
                else if (verbEn === "can/to be able") verbText = "could";
                else if (verbEn === "to say/tell") verbText = "said/told";
                else if (verbEn === "to give") verbText = "gave";
                else if (verbEn === "to see") verbText = "saw";
                else if (verbEn === "to know") verbText = "knew";
                else if (verbEn === "to want") verbText = "wanted";
                else if (verbEn === "to come") verbText = "came";
                else if (verbEn === "to stay/remain") verbText = "stayed";
                else if (verbEn === "to put") verbText = "put";
                else if (verbEn === "to bring") verbText = "brought";
                else if (verbEn === "to leave/let") verbText = "left/let";
                else if (verbEn === "to speak") verbText = "spoke";
                else if (verbEn === "to pass") verbText = "passed";
                else if (verbEn === "to arrive") verbText = "arrived";
            } else if (tense === "present") {
                verbText = verbEn.replace("to ", "");
                // Add 's' for third person singular in present
                if (pronounEn === "he/she/you") {
                    if (verbText.endsWith("y")) verbText = verbText.slice(0, -1) + "ies";
                    else if (verbText.endsWith("o") || verbText.endsWith("s") || verbText.endsWith("sh") || verbText.endsWith("ch")) {
                        verbText += "es";
                    } else if (verbText === "have") {
                        verbText = "has";
                    } else if (verbText === "be") {
                        verbText = "is";
                    } else if (verbText === "can/be able") {
                        verbText = "can";
                    } else {
                        verbText += "s";
                    }
                }
                if (verbText === "be" && pronounEn === "I") verbText = "am";
                else if (verbText === "be") verbText = "are";
                if (verbText === "have/exist" && pronounEn === "he/she/you") verbText = "has";
                else if (verbText === "have/exist") verbText = "have";
                if (verbText === "can/be able" || verbText === "cans/be able") verbText = "can";
            } else {
                verbText = verbEn.replace("to ", "");
            }

            return prefix + verbText;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function normalizeAnswer(answer) {
            return answer
                .toLowerCase()
                .trim()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, ""); // Remove accents for comparison
        }

        function filterQuestions() {
            if (selectedTense === "all") {
                filteredQuestions = [...questions];
            } else {
                filteredQuestions = questions.filter(q => q.tenseKey === selectedTense);
            }
            filteredQuestions = shuffleArray(filteredQuestions);
        }

        function changeTense() {
            selectedTense = document.getElementById('tenseSelect').value;
            currentQuestionIndex = 0;
            correctAnswers = 0;
            isWaitingForCorrection = false;
            mistakes = [];
            
            // Reset attempts for all questions
            questions.forEach(q => q.attempts = 0);
            
            filterQuestions();
            displayQuestion();
            updateMistakesList();
        }

        function displayQuestion() {
            const question = filteredQuestions[currentQuestionIndex];
            const quizArea = document.getElementById('quizArea');
            
            quizArea.innerHTML = `
                <div class="quiz-card">
                    <div class="verb-info">Verb: ${question.verb} (${question.verbEnglish}) ‚Ä¢ Tense: ${question.tense}</div>
                    <div class="prompt">Translate to Portuguese:</div>
                    <div class="english-phrase">${question.englishPhrase}</div>
                    <div class="input-group">
                        <input type="text" id="answerInput" placeholder="Type your answer here..." autocomplete="off" autofocus>
                        <div class="accent-buttons">
                            <button type="button" class="accent-btn" onclick="addAccent('√°')">√°</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√©')">√©</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√≠')">√≠</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√≥')">√≥</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√∫')">√∫</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√¢')">√¢</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√™')">√™</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√¥')">√¥</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√£')">√£</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√µ')">√µ</button>
                            <button type="button" class="accent-btn" onclick="addAccent('√ß')">√ß</button>
                        </div>
                    </div>
                    <div id="feedback"></div>
                    <button id="submitBtn" onclick="checkAnswer()">Submit Answer</button>
                    <div class="hint">Use the pronoun: ${question.pronoun}${question.pronoun.includes('/') ? ' (any one)' : ''}</div>
                </div>
            `;

            // Add enter key listener
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });

            updateProgress();
        }

        function addAccent(char) {
            const input = document.getElementById('answerInput');
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            
            // Insert character at cursor position
            input.value = text.substring(0, start) + char + text.substring(end);
            
            // Move cursor after inserted character
            input.selectionStart = input.selectionEnd = start + 1;
            
            // Keep focus on input
            input.focus();
        }

        function checkAnswerVariations(userAnswer, correctAnswer, pronoun) {
            // Normalize the correct answer
            const normalizedCorrect = normalizeAnswer(correctAnswer);
            
            // Check exact match first
            if (userAnswer === normalizedCorrect) {
                return true;
            }
            
            // If the pronoun contains multiple options (e.g., "ele/ela/voc√™" or "eles/elas")
            if (pronoun.includes('/')) {
                const pronounOptions = pronoun.split('/');
                const conjugation = correctAnswer.replace(pronoun, '').trim();
                
                // Check if user's answer matches any pronoun variation
                for (let pronounOption of pronounOptions) {
                    const variation = `${pronounOption} ${conjugation}`;
                    const normalizedVariation = normalizeAnswer(variation);
                    if (userAnswer === normalizedVariation) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        function checkAnswer() {
            const question = filteredQuestions[currentQuestionIndex];
            const userAnswer = document.getElementById('answerInput').value;
            const feedback = document.getElementById('feedback');
            const input = document.getElementById('answerInput');
            const submitBtn = document.getElementById('submitBtn');

            if (!userAnswer.trim()) {
                return;
            }

            const normalizedUser = normalizeAnswer(userAnswer);
            const isCorrect = checkAnswerVariations(normalizedUser, question.answer, question.pronoun);

            if (isCorrect) {
                // Correct answer
                input.classList.remove('incorrect');
                input.classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = '‚úì Correct!';
                
                if (!isWaitingForCorrection) {
                    correctAnswers++;
                }
                
                isWaitingForCorrection = false;
                
                // Move to next question after a short delay
                setTimeout(() => {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < filteredQuestions.length) {
                        displayQuestion();
                    } else {
                        showCompletion();
                    }
                }, 1000);
                
                submitBtn.disabled = true;
            } else {
                // Incorrect answer
                input.classList.remove('correct');
                input.classList.add('incorrect');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `
                    ‚úó Incorrect. The correct answer is:<br>
                    <div class="correct-answer">${question.answer}</div>
                    <br>Please type the correct answer to continue.
                `;
                
                // Add to mistakes list (only first attempt)
                if (!isWaitingForCorrection) {
                    addMistake(question);
                }
                
                isWaitingForCorrection = true;
                question.attempts++;
                input.value = '';
                input.focus();
            }
        }

        function addMistake(question) {
            // Check if this exact question is already in mistakes
            const alreadyAdded = mistakes.some(m => 
                m.englishPhrase === question.englishPhrase && 
                m.answer === question.answer
            );
            
            if (!alreadyAdded) {
                mistakes.push({
                    englishPhrase: question.englishPhrase,
                    answer: question.answer,
                    verb: question.verb,
                    verbEnglish: question.verbEnglish,
                    tense: question.tense
                });
                updateMistakesList();
            }
        }

        function updateMistakesList() {
            const mistakesList = document.getElementById('mistakesList');
            const mistakesCount = document.getElementById('mistakesCount');
            
            mistakesCount.textContent = mistakes.length;
            
            if (mistakes.length === 0) {
                mistakesList.innerHTML = '';
                return;
            }
            
            // Show newest mistakes first (reverse order)
            mistakesList.innerHTML = [...mistakes].reverse().map(mistake => `
                <div class="mistake-item">
                    <div class="mistake-english">${mistake.englishPhrase}</div>
                    <div class="mistake-answer">‚úì ${mistake.answer}</div>
                    <div class="mistake-verb-info">${mistake.verb} (${mistake.verbEnglish}) ‚Ä¢ ${mistake.tense}</div>
                </div>
            `).join('');
        }

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const stats = document.getElementById('stats');
            const total = filteredQuestions.length;
            const percentage = (correctAnswers / total) * 100;
            
            progressBar.style.width = percentage + '%';
            progressBar.textContent = `${correctAnswers}/${total}`;
            stats.textContent = `Questions answered: ${correctAnswers} / ${total}`;
        }

        function showCompletion() {
            const quizArea = document.getElementById('quizArea');
            const totalAttempts = filteredQuestions.reduce((sum, q) => sum + q.attempts, 0);
            const accuracy = ((filteredQuestions.length / (filteredQuestions.length + totalAttempts)) * 100).toFixed(1);
            const totalQuestions = filteredQuestions.length;
            
            quizArea.innerHTML = `
                <div class="completion">
                    <h2>üéâ Congratulations!</h2>
                    <p>You've completed all ${totalQuestions} questions!</p>
                    <p style="font-size: 24px; color: #667eea; margin: 20px 0;">
                        Accuracy: ${accuracy}%
                    </p>
                    <p>Total questions: ${totalQuestions}</p>
                    <p>Extra attempts needed: ${totalAttempts}</p>
                    <button id="submitBtn" onclick="restartQuiz()" style="margin-top: 30px;">Start Over</button>
                </div>
            `;
        }

        function restartQuiz() {
            questions.forEach(q => q.attempts = 0);
            currentQuestionIndex = 0;
            correctAnswers = 0;
            isWaitingForCorrection = false;
            mistakes = [];
            filterQuestions();
            displayQuestion();
            updateMistakesList();
        }

        // Start the quiz
        filterQuestions();
        displayQuestion();
        updateMistakesList();
    </script>
</body>
</html>

